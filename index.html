<head>
  <title>GLSL Editor</title>
  <link type="text/css" rel="stylesheet" href="glslEditor.css">
<script type="application/javascript" src="glslEditor.js"></script>
</head>
<style>
  body {
    padding: 0;
    margin: 0;

  }
  </style>
  <script>
    const shaders = [{name: 'Line', code: `#ifdef GL_ES
precision mediump float;
#endif

uniform vec2 u_resolution;
uniform vec2 u_mouse;
uniform float u_time;

float line( vec2 _st,
            vec2 _p1, vec2 _p2,
            float _width, float _spread){

    _width = 1.0 / _width;
    vec2 p2p1 = _p1 - _p2;
    vec2 p1p2 = -(p2p1);
    vec2 p2p = _st - _p2;
    vec2 p1p = _st - _p1;
    vec2 pp1 = -(p1p);
    vec2 pd = normalize(vec2(p2p1.y, -p2p1.x));
    float proj = dot(pd, pp1);
    float pr1 = dot(p2p1, p2p);
    float pr2 = dot(p1p2, p1p);

    if(pr1 > 0.0 && pr2 > 0.0) {
        return pow(1.0 / abs(proj * _width), _spread);
    } else {
        return 0.0;
    }
}

void main(){
    vec2 st = gl_FragCoord.xy/u_resolution.xy;

    vec3 color = vec3( line(st,
                            vec2(0.1),
                            vec2(0.9),
                            0.005, 3.0) );

    gl_FragColor = vec4(color,1.0);
}
`}, {name: 'Cross', code: `
#ifdef GL_ES
precision mediump float;
#endif

uniform vec2 u_resolution;
uniform vec2 u_mouse;
uniform float u_time;

float box(in vec2 st, in vec2 size){
    size = vec2(0.5) - size*0.5;
    vec2 uv = smoothstep(size,
                        size+vec2(0.001),
                        st);
    uv *= smoothstep(size,
                    size+vec2(0.001),
                    vec2(1.0)-st);
    return uv.x*uv.y;
}

float cross(in vec2 st, float size){
    return  box(st, vec2(size,size/4.)) +
            box(st, vec2(size/4.,size));
}

void main(){
    vec2 st = gl_FragCoord.xy/u_resolution.xy;

    gl_FragColor = vec4( vec3( cross(st,0.4) ) ,1.0);
}
`}, {name: 'Triangle', code: `
#ifdef GL_ES
precision mediump float;
#endif

uniform vec2 u_resolution;
uniform vec2 u_mouse;
uniform float u_time;

// Based on https://www.shadertoy.com/view/4sSSzG
float triangle (vec2 st,
                vec2 p0, vec2 p1, vec2 p2,
                float smoothness){
  vec3 e0, e1, e2;

  e0.xy = normalize(p1 - p0).yx * vec2(+1.0, -1.0);
  e1.xy = normalize(p2 - p1).yx * vec2(+1.0, -1.0);
  e2.xy = normalize(p0 - p2).yx * vec2(+1.0, -1.0);

  e0.z = dot(e0.xy, p0) - smoothness;
  e1.z = dot(e1.xy, p1) - smoothness;
  e2.z = dot(e2.xy, p2) - smoothness;

  float a = max(0.0, dot(e0.xy, st) - e0.z);
  float b = max(0.0, dot(e1.xy, st) - e1.z);
  float c = max(0.0, dot(e2.xy, st) - e2.z);

  return smoothstep(smoothness * 2.0,
                    1e-7,
                    length(vec3(a, b, c)));
}

void main(){
  vec2 st = gl_FragCoord.xy/u_resolution.xy;

  vec3 color = vec3( triangle(st,
                              vec2(0.0,0.15),
                              vec2(1.0,0.15),
                              vec2(0.5,0.88),
                              0.001) );

  gl_FragColor = vec4(color,1.0);
}
`}, { name: 'Circle', code: `
#ifdef GL_ES
precision mediump float;
#endif

uniform vec2 u_resolution;
uniform vec2 u_mouse;
uniform float u_time;
float circle(in vec2 _st, in float _radius){
    vec2 dist = _st-vec2(0.5);
    return 1.-smoothstep(_radius-(_radius*0.01),
                         _radius+(_radius*0.01),
                         dot(dist,dist)*4.0);
}
void main(){
    vec2 st = gl_FragCoord.xy/u_resolution.xy;
    vec3 color = vec3(circle(st,0.9));
    gl_FragColor = vec4( color, 1.0 );
  }`}]
const code = JSON.parse(localStorage.getItem('glslEditor-last-content'));
shaders.forEach(shader => {
  // if (!code[shader.name]) {
    code[shader.name] = shader.code;
  // }
})
console.log(code)
localStorage.setItem('glslEditor-last-content', JSON.stringify(code));

  </script>

<body>
  <div id="glsl_editor"></div>
</body>
<script type="text/javascript">
  const glslEditor = new GlslEditor('#glsl_editor', { 
      canvas_size: 500,
      canvas_draggable: true,
      theme: 'monokai',
      multipleBuffers: true,
      watchHash: true,
      fileDrops: true,
      menu: true
  });
</script>